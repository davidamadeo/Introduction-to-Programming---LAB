from matplotlib import pyplot as plt
import csv
from datetime import datetime as dt
from datetime import timedelta


class Holder:
    def __init__(self, name, startBal=0.0):
        self.name = name
        self.balance = float(startBal)

    def deduct(self, num):
        self.balance -= float(num)

    def add(self, num):
        self.balance += float(num)


class Loan:
    def __init__(self, principle, termLoan, interest, interestAmount, faceValue):
        self.principle = principle
        self.startingDate = dt.strptime(dt.strftime(dt.now(), '%Y-%m-%d'), '%Y-%m-%d')
        self.termLoan = int(termLoan)
        self.maturityDate = self.startingDate + timedelta(days=termLoan)
        self.interestName = interest
        self.interestRate = interestAmount
        self.faceValue = faceValue
        self.nominalYield = (self.interestRate / self.faceValue) * 100


allHolder = []
allLoan = []


def printHolderList():
    for i in range(len(allHolder)):
        print(i + 1, allHolder[i].name, allHolder[i].balance)


def printLoanList():
    for i in range(len(allLoan)):
        print(i + 1, allLoan[i].principle, allLoan[i].termLoan, allLoan[i].maturityDate, allLoan[i].interest, allLoan[i].interestAmount, allLoan[i].faceValue, allLoan[i].nominalYield)


def loadHolder():
    filename = 'holders.csv'
    with open(filename) as file:
        reader = csv.reader(file)
        header_row = next(reader)
        for row in reader:
            allHolder.append(Holder(row[0], row[1]))


def writeHolder():
    writefile1 = 'holders.csv'
    with open(writefile1, 'w') as file1:
        writer = csv.writer(file1)
        writer.writerow(['name', 'balance'])
        for i in range(len(allHolder)):
            writer.writerow([allHolder[i].name, allHolder[i].balance])


def writeLoan():
    writefile1 = 'laons.csv'
    with open(writefile1, 'w') as file1:
        writer = csv.writer(file1)
        writer.writerow['prinincple', ]


def loadLoan():
    filename = 'loans.csv'
    with open(filename) as file:
        reader = csv.reader(file)
        header_row = next(reader)
        for row in reader:
            allLoan.append(Loan(row[0], row[1], row))


def makePlot(x, y):
    plt.figure(dpi=100, figsize=(12, 6))
    plt.bar(x, y, width=1, color='red', edgecolor='yellow')
    plt.title('Balance', fontsize=24)
    plt.tick_params(labelsize=8)
    plt.show()


def main():
    loadHolder()
    while True:
        firstInput = input('''What do you want to do?
1. Add Holder
2. View Holders
3. Deposit
4. Withdraw
5. Add loan
6. View Loans
9. Delete Holder
0. Quit
> ''')
        if firstInput == '1':
            holderNameInput = input('Enter Holder name: ')
            startBalInput = float(input('Enter starting balance: '))
            allHolder.append(Holder(holderNameInput, startBalInput))
        elif firstInput == '2':
            printHolderList()
        elif firstInput == '3':
            screen3Run = True
            while screen3Run:
                print('Choose account')
                printHolderList()
                chooseHolderInput = input('> ')
                for i in range(len(allHolder)):
                    if int(chooseHolderInput) - 1 in range(len(allHolder)):
                        workingHolder = allHolder[int(chooseHolderInput) - 1]
                        numInput = float(input('Amount: '))
                        workingHolder.add(numInput)
                        print('Balance: {}'.format(workingHolder.balance))
                        screen3Run = False
                        break
        elif firstInput == '4':
            screen4Run = True
            while screen4Run:
                print('Choose account')
                printHolderList()
                chooseHolderInput = input('> ')
                for i in range(len(allHolder)):
                    if int(chooseHolderInput) - 1 in range(len(allHolder)):
                        workingHolder = allHolder[int(chooseHolderInput) - 1]
                        numInput = float(input('Amount: '))
                        workingHolder.deduct(numInput)
                        print('Balance: {}'.format(workingHolder.balance))
                        screen4Run = False
                        break
        elif firstInput == '5':
            principleInput = input('Principle (Name of item to borrow): ')
            termLoanInput = int(input('Term of loan (How many days): '))
            interestInput = input('Interest: ')
            InterestAmountInput = int(input('Interest Quantities: '))
            faceValueInput = int(input('Face Value (Value of item to borrow): '))
            allLoan.append(Loan(principleInput, termLoanInput, interestInput, InterestAmountInput, faceValueInput))
            for loan in allLoan:
                print('''Name of item you loan: {}
Due date: {}
Nominal Yield: {}'''.format(loan.principle, loan.maturityDate, loan.nominalYield))
        elif firstInput == '6':
            printLoanList()
        elif firstInput == '9':
            screen9Run = True
            while screen9Run:
                printHolderList()
                delHolderInput = int(input('Holder\n>'))
                if delHolderInput - 1 in range(len(allHolder)):
                    del allHolder[delHolderInput - 1]
                    screen9Run = False
        elif firstInput == '0':
            writeHolder()
            name, bal = [], []
            for i in range(len(allHolder)):
                name.append(allHolder[i].name)
                bal.append(allHolder[i].balance)
            makePlot(name, bal)
            exit()


main()

